var AtgServiceConstants={TIME_OUT:10000};var AjaxLogger={islogEnable:false,log:function(b){if(this.islogEnable){try{console.log(b)}catch(a){}}}};var CacheManager={put:function(a,b){if(a!=null&&a!=""){jQuery("body").data(a,b)}},get:function(a){if(a!=null&&a!=""){return jQuery("body").data(a)}}};var AjaxServiceUtil={isNotBlank:function(a){if(typeof a!="undefined"&&a!=null&&a!=""&&a!="null"){return true}return false},isBlank:function(a){return !AjaxServiceUtil.isNotBlank(a)},showLoadingImage:function(a){if(this.isNotBlank(a)){jQuery("#"+a).html('<div id="" class="processingImage center rel" style="min-height:35px;"><img style="margin-top:17px;" alt="" src="/olam/images/brand30/ajaxLoader.gif" /></div>')}},equals:function(b,a){if(AjaxServiceUtil.isNotBlank(b)&&AjaxServiceUtil.isNotBlank(a)&&b==a){return true}else{return false}},getContentType:function(a){var b="application/x-www-form-urlencoded; charset=UTF-8";if(AjaxServiceUtil.equals("jsonp",a)){b="application/json"}return b},getBrowserType:function(){if(jQuery.browser.msie){return"IE"}else{if(jQuery.browser.mozilla){return"Mozilla"}else{if(jQuery.browser.webkit){var b=/chrome/.test(navigator.userAgent.toLowerCase())&&/Google Inc/.test(navigator.vendor);if(b){return"Chrome"}var a=/safari/.test(navigator.userAgent.toLowerCase())&&/Apple Computer/.test(navigator.vendor);if(a){return"Safari"}return"Other"}else{if(jQuery.browser.opera){return"Opera"}else{return"Others"}}}}},getBrowserVersion:function(){return jQuery.browser.version}};var AjaxProcessorRegistry={ajaxRegistry:new Array(),push:function(a){this.ajaxRegistry.push(a)},pop:function(){return this.ajaxRegistry.pop()},size:function(){return this.ajaxRegistry.length}};var DomReadyListenerRegistry={listenerRegistry:new Array(),push:function(a){this.listenerRegistry.push(a)},pop:function(){return this.listenerRegistry.pop()},size:function(){return this.listenerRegistry.length}};var AjaxInvoker={requestInProgressCount:0,getRequestInProgressCount:function(){return this.requestInProgressCount},getAjaxRawInput:function(){var a={url:null,timeout:null,data:null,dataType:null,contentType:null};return a},getAjaxInputFromProcessor:function(c){if(AjaxServiceUtil.isNotBlank(c)){var a=this.getAjaxRawInput();a.url=c.getUrl();try{a.data=c.getPostParams()}catch(b){a.data=""}try{a.timeout=c.getTimeout();if(AjaxServiceUtil.isBlank(a.timeout)){a.timeout=AtgServiceConstants.TIME_OUT}}catch(b){a.timeout=AtgServiceConstants.TIME_OUT}try{a.dataType=c.getDataType()}catch(b){a.dataType="POST"}a.contentType=AjaxServiceUtil.getContentType(a.dataType);return a}},invokeAjaxCall:function(d,b){var a=this.getAjaxInputFromProcessor(d);var c=new Date();return jQuery.ajax({type:"POST",url:a.url,async:true,cache:false,timeout:a.timeout,data:a.data,jsonpCallback:"myattPromotionCallback",dataType:a.dataType,contentType:a.contentType,beforeSend:function(e){this.requestInProgressCount++;d.beforeSend(e);AjaxLogger.log(d.getRequestId()+" in Progress,  StartTime["+new Date()+"]");c=new Date().getTime()},success:function(e){var f=new Date().getTime();var g=f-c;AjaxLogger.log(d.getRequestId()+" Success "+new Date()+" ExecutionTime ["+g+"ms]");this.result=d.successCallBack(e);if(b!=null&&typeof b!="undefined"){b.notifySuccess()}this.requestInProgressCount--},error:function(f,g,e){AjaxLogger.log(d.getRequestId()+" Failed");AjaxLogger.log(g+" -- "+e);this.result=d.failureCallBack(f,g,e);if(b!=null&&typeof b!="undefined"){b.notifyFailure()}this.requestInProgressCount--}})}};function myattPromotionCallback(a){AjaxLogger.log("Called jsonp callback method")}var AjaxService={MAX_REQUESTS_ALLOWED_PARALLEL:5,isDomReady:false,createAjaxProcessor:function(f,g,c,b,h,e,a,d){return AjaxProcessorManager.getGenericAjaxProcessor(f,g,c,b,h,e,a,d)},cacheAjaxProcessor:function(a){if(a!=null){var b=a.getRequestId();if(typeof b!="undefined"&&b!=null&&b!=""){CacheManager.put(b,a)}}},getAjaxProcessorbyId:function(a){return CacheManager.get(a)},executeBeforeDomReadyProcessor:function(a){if(AjaxServiceUtil.isNotBlank(a)){AjaxInvoker.invokeAjaxCall(a,null)}},registerAndExecuteAjaxProcessor:function(a){AjaxLogger.log(a.getRequestId()+" Registered with core Framwork");AjaxProcessorRegistry.push(a);this.cacheAjaxProcessor(a);this.executeRegisteredProcessors()},executeRegisteredProcessors:function(){if(this.isDomReady){var a=AjaxProcessorRegistry.size();if(a>0){var c={notifySuccess:function(){var d=AjaxProcessorRegistry.pop();if(d!=null&&typeof d!="undefined"){AjaxInvoker.invokeAjaxCall(d,this)}},notifyFailure:function(){var d=AjaxProcessorRegistry.pop();if(d!=null&&typeof d!="undefined"){AjaxInvoker.invokeAjaxCall(d,this)}}};for(i=0;i<AjaxProcessorRegistry.size();i++){if(AjaxInvoker.getRequestInProgressCount()<this.MAX_REQUESTS_ALLOWED_PARALLEL){var b=AjaxProcessorRegistry.pop();if(b!=null&&typeof b!="undefined"){AjaxInvoker.invokeAjaxCall(b,c)}}else{break}}}}},registerDomReadyEventListener:function(a){if(AjaxServiceUtil.isNotBlank(a)){DomReadyListenerRegistry.push(a);if(AjaxService.isDomReady){this.notifyAllDomReadyEvent()}}},notifyAllDomReadyEvent:function(){while(DomReadyListenerRegistry.size()>0){var a=DomReadyListenerRegistry.pop();if(AjaxServiceUtil.isNotBlank(a)){a.notify()}}}};var AjaxProcessorManager={getGenericAjaxProcessor:function(f,g,c,b,h,e,a,d){return new this.GenericAjaxProcessor(f,g,c,b,h,e,a,d)},GenericAjaxProcessor:function(actionURL,requestId,containerId,childReqs,postParams,ajaxCallback,hideLoadingImage,callbackParams){this.actionURL=actionURL;this.requestId=requestId;this.postParams=postParams;this.containerId=containerId;this.childReqs=childReqs;this.ajaxCallback=ajaxCallback;this.callbackParams=callbackParams;this.hideLoadingImage=hideLoadingImage;this.getRequestId=function(){return this.requestId};this.getUrl=function(){return this.actionURL};this.getPostParams=function(){return this.postParams};this.getDataType=function(){return"html"};this.beforeSend=function(xhr){var alreadyHandled=false;if(AjaxServiceUtil.isNotBlank(this.ajaxCallback)){try{eval(this.ajaxCallback+".preProcessing(this.containerId,this.callbackParams,xhr);");alreadyHandled=true}catch(ex){}}if(!alreadyHandled&&!hideLoadingImage){AjaxServiceUtil.showLoadingImage(this.containerId)}};this.successCallBack=function(response){var alreadyHandled=false;if(AjaxServiceUtil.isNotBlank(this.ajaxCallback)){try{eval(this.ajaxCallback+".successCallback(this.containerId,this.callbackParams,response);");alreadyHandled=true}catch(ex){}}if(!alreadyHandled&&AjaxServiceUtil.isNotBlank(this.containerId)){jQuery("#"+this.containerId).html(response)}if(this.childReqs!=null&&this.childReqs!="null"){var childReqArray=this.childReqs.split(",");for(var i=0;i<childReqArray.length;i++){var childRequestId=childReqArray[i];var childReqObj=CacheManager.get(childRequestId);if(childReqObj!=null){AjaxService.registerAndExecuteAjaxProcessor(childReqObj)}}}};this.failureCallBack=function(xhr,textStatus,errorThrown){var alreadyHandled=false;if(AjaxServiceUtil.isNotBlank(this.ajaxCallback)){try{eval(this.ajaxCallback+".failureCallback(this.containerId,this.callbackParams,xhr, textStatus, errorThrown);");alreadyHandled=true}catch(ex){}}if(!alreadyHandled&&AjaxServiceUtil.isNotBlank(this.containerId)){jQuery("#"+this.containerId).html("")}return""}}};document.onreadystatechange=function(){if(document.readyState==="complete"){AjaxLogger.log("DOM READY EVENT START "+new Date());AjaxService.isDomReady=true;AjaxService.executeRegisteredProcessors();AjaxService.notifyAllDomReadyEvent()}};var MyAttTdataConfig={logMetricsEnabled:false,isFailSafeEnabled:false,tdataTimeOut:1500,tdataTrackingEnabled:false,setLogMetricsEnabled:function(a){if(AjaxServiceUtil.isNotBlank(a)){this.logMetricsEnabled=a}},setFailSafeEnabled:function(a){if(AjaxServiceUtil.isNotBlank(a)){this.isFailSafeEnabled=a}},setJavascriptConsoleLogsEnabled:function(a){if(AjaxServiceUtil.isNotBlank(a)){AjaxLogger.islogEnable=a}},setTdataTimeOut:function(a){if(AjaxServiceUtil.isNotBlank(a)){this.tdataTimeOut=a}},enableTdataTracking:function(a){if(AjaxServiceUtil.isNotBlank(a)){this.tdataTrackingEnabled=a}}};var DashboardPromotionManager={dashboardPage:false,postDashSyncComplete:false,listOfAtgPromotions:new Array(),isDashboardPage:function(){return this.dashboardPage},registerAtgPromotionId:function(a){AjaxLogger.log(a+" is registered with Dashboard Promotion Manager");this.dashboardPage=true;this.listOfAtgPromotions.push(a)},setDashboardPageFlag:function(a){this.dashboardPage=a},showAtgPromotions:function(){AjaxLogger.log("PostDash Sync is completed, Number of requests need to resgister for dashboard promotions["+this.listOfAtgPromotions.length+"]");this.postDashSyncComplete=true;jQuery.each(this.listOfAtgPromotions,function(b,a){if(AjaxServiceUtil.isNotBlank(a)){var c=CacheManager.get(a);if(AjaxServiceUtil.isNotBlank(c)){AjaxService.registerAndExecuteAjaxProcessor(c)}}})}};var TdataLoggingInfo={pageId:"",transactionId:"Not Defined",executionTime:0,errorCode:0,textStatus:"",errorThrown:"",response:"",setErrorMessage:function(a){if(AjaxServiceUtil.isNotBlank(a)){this.errorCode=a;if("1"==a){this.errorThrown="Response does not contain data for expected Inventory Space Id"}else{if("2"==a){this.errorThrown="inventorySpaceId in Response is undefined"}else{if("3"==a){this.errorThrown="externalContentId in Response is undefined"}}}}},getErrorMessage:function(){return"errorCode["+this.errorCode+"] textStatus["+this.textStatus+"] errorThrown["+this.errorThrown+"]"}};var AtgPromoPageRegistry={atgPromotionsArr:new Array(),push:function(a,b){var c=new this.atgPromotion(a,b);this.atgPromotionsArr.push(c)},pop:function(){var a=this.atgPromotionsArr.pop();return a},size:function(){return this.atgPromotionsArr.length},atgPromotion:function(a,b){this.targeter=a;this.promotionPageId=b}};var AtgPromotionTracking={requestCount:0,waitForTdata:false,setWaitForTdata:function(a){this.waitForTdata=a;this.sendTrackingReport()},trackAtgPromotion:function(a,b){if(AjaxServiceUtil.isNotBlank(a)&&AjaxServiceUtil.isNotBlank(b)){this.registerPromotion(a,b)}this.requestCount--;this.sendTrackingReport()},trackAtgPromotionWithNoResult:function(a){this.requestCount--;AjaxLogger.log("Targeter: "+a+" returned no promotions");this.sendTrackingReport()},registerPromotion:function(a,b){AjaxLogger.log("Registering promotion for tracking. Targeter:"+a+" | promotion: "+b);AtgPromoPageRegistry.push(a,b)},reportRequestStart:function(){this.requestCount++},reportRequestSuccess:function(){},reportRequestFailure:function(){this.requestCount--;this.sendTrackingReport()},sendTrackingReport:function(){if(!this.waitForTdata&&this.requestCount<=0){this.requestCount=0;var a=AtgPromoPageRegistry.size();var c="";for(i=0;i<a;i++){var b=AtgPromoPageRegistry.pop();if(AjaxServiceUtil.isNotBlank(b)){if(AjaxServiceUtil.isNotBlank(b.targeter)&&AjaxServiceUtil.isNotBlank(b.promotionPageId)){if(AjaxServiceUtil.isBlank(c)){c=b.promotionPageId+"~~"+b.targeter+"~~~ATG"}else{c=c+"|"+b.promotionPageId+"~~"+b.targeter+"~~~ATG"}}}}if(AjaxServiceUtil.isNotBlank(c)){}}}};jQuery(window).bind("beforeunload",function(){TdataPromotionTracking.reportSatellite()});var TdataPromotionTracking={count:0,renderedSlotCount:0,promotions:[],domReadyEventRegistered:false,reset:function(){AjaxLogger.log("TdataPromotionTracking.reset");this.count=0;this.renderedSlotCount=0;this.promotions=[];this.domReadyEventRegistered=false},debugTdataReporting:function(){AjaxLogger.log("count ["+this.count+"]");AjaxLogger.log("renderedSlotCount ["+this.renderedSlotCount+"]");AjaxLogger.log("promotions ["+JSON.stringify(this.promotions)+"]")},increasePromotionCount:function(){this.count++},decreasePromotionCount:function(){if(this.count!=0){this.count--}},reportPromotion:function(b){AjaxLogger.log("In reportPromotion "+JSON.stringify(b));if(AjaxServiceUtil.isNotBlank(b)){if(jQuery.isArray(b)){this.renderedSlotCount+=b.length;jQuery.each(b,function(d,c){if(AjaxServiceUtil.isNotBlank(c)){TdataPromotionTracking.promotions.push(c)}})}else{this.renderedSlotCount++;this.promotions.push(b)}AjaxLogger.log(this.count+" -- "+this.renderedSlotCount);if(!TdataPromotionTracking.domReadyEventRegistered){TdataPromotionTracking.domReadyEventRegistered=true;var a={notify:function(){TdataPromotionTracking.reportSatellite()}};AjaxService.registerDomReadyEventListener(a)}}},reportSatellite:function(){AjaxLogger.log("Tdata reporting array= "+JSON.stringify(this.promotions));if(this.promotions.length>0){var a=this.promotions;this.reset();AjaxLogger.log("Calling _satellite.tdata");_satellite.tdata(a);if(MyAttTdataConfig.tdataTrackingEnabled){this.reportPromoService(a)}}},reportPromoService:function(b){if(b.length>0){AjaxLogger.log("Tdata reporting service= "+JSON.stringify(b));var a={getRequestId:function(){return"tdata_promo_tracking"},getUrl:function(){var c="/personalizationservice/auth/promotionReportingTracking";return c},getPostParams:function(){var c="promoType=TDATA&transactionId="+encodeURIComponent(TdataLoggingInfo.transactionId)+"&reportingData=";jQuery.each(b,function(e,d){if(AjaxServiceUtil.isNotBlank(d)){c+=encodeURIComponent(d.contentid+"---"+d.inventoryid+"---"+d.externalContentid+"~")}});return c},beforeSend:function(c){},successCallBack:function(c){},failureCallBack:function(d,e,c){}};AjaxService.registerAndExecuteAjaxProcessor(a)}}};var AtgPromotionCallback={preProcessing:function(a,b,c){AjaxServiceUtil.showLoadingImage(a);AtgPromotionTracking.reportRequestStart()},successCallback:function(a,c,b){if(AjaxServiceUtil.isNotBlank(a)){jQuery("#"+a).html(b)}AtgPromotionTracking.reportRequestSuccess()},failureCallback:function(a,b,d,e,c){if(AjaxServiceUtil.isNotBlank(a)){jQuery("#"+a).html("")}AtgPromotionTracking.reportRequestFailure()}};var TdataAjaxProcessorManager={getTdataAjaxProcessor:function(a,c){var b=new this.TdataAjaxProcessor(a,c);return b},getPersonalizationAjaxProcessor:function(a,b,c,d){return new this.PersonalizationAjaxProcessor(a,b,c,d)},TdataAjaxProcessor:function(a,b){this.url=a;this.postParams=b;this.startTime=0;this.response=null;this.getRequestId=function(){return"tdataRequest"};this.getUrl=function(){return this.url};this.getPostParams=function(){return this.postParams};this.getDataType=function(){return"jsonp"};this.getTimeout=function(){return MyAttTdataConfig.tdataTimeOut};this.beforeSend=function(c){this.startTime=new Date().getTime();AjaxLogger.log("Tdata start time ["+this.startTime+"]");TdataLoggingInfo.executionTime=0};this.successCallBack=function(d){TdataLoggingInfo.executionTime=new Date().getTime()-this.startTime;AjaxLogger.log("Entered Tdata success call back ");var c=true;if(AjaxServiceUtil.isBlank(d)){this.failureCallBack(null,"INVALID_RESPONSE","executionTime["+TdataLoggingInfo.executionTime+"]");c=false}else{if(TdataLoggingInfo.executionTime>this.getTimeout()){this.failureCallBack(null,"SUPPOSED_TO_TIMEOUT","executionTime["+TdataLoggingInfo.executionTime+"]")}}if(c){TdataPromotionService.isTdataSuccess=true;this.response=d;if(AjaxService.isDomReady){AjaxLogger.log("Entered in dom ready block");TdataPromotionService.tdataSuccessCallback(d,false)}else{AjaxLogger.log("Dom is not ready, waiting ....");TdataPromotionService.tdataSuccessCallback(d,true);var e={tdataProcesser:null,notify:function(){AjaxLogger.log("Executing Tdata dom ready event Listner");if(AjaxServiceUtil.isNotBlank(this.tdataProcesser)){TdataPromotionService.tdataSuccessCallback(this.tdataProcesser.response)}}};e.tdataProcesser=this;AjaxService.registerDomReadyEventListener(e)}}AtgPromotionTracking.setWaitForTdata(false)};this.failureCallBack=function(e,f,d){AjaxLogger.log("in FailureCAllback execution time["+TdataLoggingInfo.executionTime+"] startTime["+this.startTime+"]");TdataLoggingInfo.textStatus=f;TdataLoggingInfo.errorThrown=d;if(AjaxServiceUtil.isNotBlank(e)){TdataLoggingInfo.errorCode=e.status}TdataPromotionService.isTdataFailed=true;if(AjaxService.isDomReady){AjaxLogger.log("Dom is ready, calling tdataFailureCallback");TdataPromotionService.tdataFailureCallback(e,f,d)}else{var c={tdataProcesser:null,xhr:null,textStatus:null,errorThrown:null,notify:function(){if(AjaxServiceUtil.isNotBlank(this.tdataProcesser)){TdataPromotionService.tdataFailureCallback(this.xhr,this.textStatus,this.errorThrown)}}};c.errorThrown=d;c.textStatus=f;c.xhr;c.tdataProcesser=this;AjaxLogger.log("Dom is not ready, registered failure Listener");AjaxService.registerDomReadyEventListener(c)}AtgPromotionTracking.setWaitForTdata(false)}},PersonalizationAjaxProcessor:function(a,b,c,d){this.promotionId=a;this.containerId=b;this.inventorySpaceId=c;this.inventorySpaceIds=null;this.isMultipleInventoryIds=false;this.contentId=d;this.getRequestId=function(){return"tdata"+this.containerId};this.getUrl=function(){var e="/personalizationservice/auth/cmspromoservice";return e};this.getPostParams=function(){var f=CacheManager.get("tdata_promo_post_params_"+this.inventorySpaceId);var e=this.inventorySpaceId;if(this.isMultipleInventoryIds){var e=this.inventorySpaceIds}postParams="executionTime="+encodeURIComponent(TdataLoggingInfo.executionTime)+"&transactionId="+encodeURIComponent(TdataLoggingInfo.transactionId)+"&promotionName="+encodeURIComponent(this.promotionId)+"&inventorySpaceId="+encodeURIComponent(e)+"&contentId="+encodeURIComponent(this.contentId);if(AjaxServiceUtil.isNotBlank(f)){postParams+="&"+f}return postParams};this.getDataType=function(){return"html"};this.beforeSend=function(e){AjaxServiceUtil.showLoadingImage(this.containerId)};this.successCallBack=function(f){if(this.containerId==this.inventorySpaceId){var e=TdataPromotionService.getPromotionContainerIdByInventorySpaceId(this.inventorySpaceId);TdataPromotionService.removeInvontorySpaceIdFromAllInventorySpaceList(this.inventorySpaceId);TdataPromotionService.removePromotionContainerIdByInventorySpaceId(this.inventorySpaceId);var g={notify:function(){jQuery("#"+e).html(f)}};AjaxService.registerDomReadyEventListener(g)}else{jQuery("#"+this.containerId).html(f)}};this.failureCallBack=function(f,g,e){jQuery("#"+this.containerId).html("");return""}},TdataFailureProcessor:function(a){this.inventorySpaceIds=a;this.getRequestId=function(){return"tdataFailureLogging"};this.getUrl=function(){var b="/personalizationservice/auth/promoserviceLogging";return b};this.getPostParams=function(){var b="errorInfo="+encodeURIComponent(TdataLoggingInfo.getErrorMessage())+"&executionTime="+encodeURIComponent(TdataLoggingInfo.executionTime)+"&transactionId="+encodeURIComponent(TdataLoggingInfo.transactionId)+"&inventorySpaceIds="+encodeURIComponent(this.inventorySpaceIds);if("SUPPOSED_TO_TIMEOUT"==TdataLoggingInfo.textStatus||"INVALID_RESPONSE"==TdataLoggingInfo.textStatus){b+="&customEvent="+encodeURIComponent(TdataLoggingInfo.textStatus)}if(AjaxServiceUtil.isNotBlank(TdataLoggingInfo.response)){}return b};this.getDataType=function(){return"html"};this.beforeSend=function(b){};this.successCallBack=function(b){};this.failureCallBack=function(c,d,b){return""}},getTdataFailureProcessor:function(a){return new this.TdataFailureProcessor(a)}};var TdataPromotionService={tdataProcessorRegistered:false,isTdataSuccess:false,isTdataFailed:false,unconditionalPromotions:{},alreadyProcessedSlots:{},listOfAllInventorySpaceIds:new Array(),registerTdataRequest:function(a,c,d){TdataLoggingInfo.pageId=a;AtgPromotionTracking.setWaitForTdata(true);TdataPromotionTracking.increasePromotionCount();if(!this.tdataProcessorRegistered){this.tdataProcessorRegistered=true;var b=TdataAjaxProcessorManager.getTdataAjaxProcessor(c,d);AjaxService.executeBeforeDomReadyProcessor(b)}else{if(AjaxService.isDomReady){if(this.isTdataSuccess){TdataPromotionService.tdataSuccessCallback(TdataLoggingInfo.response)}else{if(this.isTdataFailed){TdataPromotionService.tdataFailureCallback(null,TdataLoggingInfo.errorCode,TdataLoggingInfo.errorThrown)}}}}},registerPromotionContainerIdAndPostParams:function(b,a,c){this.listOfAllInventorySpaceIds.push(b);CacheManager.put("tdata_promo_container_"+b,a);CacheManager.put("tdata_promo_post_params_"+b,c);if(AjaxServiceUtil.isNotBlank(a)){AjaxServiceUtil.showLoadingImage(a)}},cacheAtgProcessorIdForInventorySpace:function(b,a){CacheManager.put("tdata_atg_"+b,a)},removeInvontorySpaceIdFromAllInventorySpaceList:function(a){if(this.listOfAllInventorySpaceIds.length!=0){this.listOfAllInventorySpaceIds=jQuery.grep(this.listOfAllInventorySpaceIds,function(b){return b!=a})}},removeInvontorySpaceIdFromAllInventorySpaceListByContainerIds:function(a){AjaxLogger.log("In removeInvontorySpaceIdFromAllInventorySpaceListByContainerIds containerIds= "+a);AjaxLogger.log("Before removing already served contaiers TdataPromotionService.listOfAllInventorySpaceIds  ="+this.listOfAllInventorySpaceIds);if(AjaxServiceUtil.isNotBlank(this.listOfAllInventorySpaceIds)&&AjaxServiceUtil.isNotBlank(a)){if(TdataPromotionService.listOfAllInventorySpaceIds.length!=0&&a.length!=0){var b=[];jQuery.each(TdataPromotionService.listOfAllInventorySpaceIds,function(e,f){var d=TdataPromotionService.getPromotionContainerIdByInventorySpaceId(f);var c=jQuery.inArray(d,a);if(c!=-1){b.push(f)}});jQuery.each(b,function(d,c){if(AjaxServiceUtil.isNotBlank(c)){AjaxLogger.log("Deleted Inventory spaceId["+c+"] from all list of inventory space ids");TdataPromotionService.listOfAllInventorySpaceIds=jQuery.grep(TdataPromotionService.listOfAllInventorySpaceIds,function(e){return e!=c})}})}}AjaxLogger.log(" After removing already served contaiers TdataPromotionService.listOfAllInventorySpaceIds  ="+this.listOfAllInventorySpaceIds)},getPromotionContainerIdByInventorySpaceId:function(a){return CacheManager.get("tdata_promo_container_"+a)},removePromotionContainerIdByInventorySpaceId:function(a){return CacheManager.put("tdata_promo_container_"+a,null)},getAtgProcessorIdByInventorySpaceId:function(a){return CacheManager.get("tdata_atg_"+a)},tdataSuccessCallback:function(b,f){var e=new Array();var d=new Array();var a=new Array();if(b.length!=0){TdataLoggingInfo.response=b;TdataLoggingInfo.transactionId=b.transactionId;TdataLoggingInfo.setErrorMessage(1);var c=b.offerRecord;AjaxLogger.log("Parsing tdata response, offers count["+c.length+"]");if(c.length!=0){jQuery.each(c,function(h,n){var p=n.externalContentId;var o=n.inventorySpaceId;var g=n.contentId;AjaxLogger.log("response from tdata api promotionId["+p+"]  inventorySpaceId["+o+"]");if(AjaxServiceUtil.isNotBlank(p)){AjaxLogger.log("TdataPromotionService.alreadyProcessedSlots="+TdataPromotionService.alreadyProcessedSlots);if(AjaxServiceUtil.isNotBlank(o)&&AjaxServiceUtil.isBlank(TdataPromotionService.alreadyProcessedSlots[o])){var l=TdataPromotionService.getPromotionContainerIdByInventorySpaceId(o);AjaxLogger.log("promotionId["+p+"]  inventorySpaceId["+o+"] containerId["+l+"]");if(f){if(false&&AjaxServiceUtil.isNotBlank(TdataPromotionService.unconditionalPromotions[o])){l=o;var j=TdataAjaxProcessorManager.getPersonalizationAjaxProcessor(p,l,o,g);d.push(j);TdataPromotionService.alreadyProcessedSlots[o]=true}}else{if(AjaxServiceUtil.isNotBlank(l)){var k=jQuery.inArray(l,e);if(k!=-1){a.push(o);var m=d[k];m.promotionId+=","+p;m.contentId+=","+g;if(AjaxServiceUtil.isNotBlank(m.inventorySpaceIds)){m.inventorySpaceIds=m.inventorySpaceIds+","+o}else{m.inventorySpaceIds=m.inventorySpaceId+","+o}m.isMultipleInventoryIds=true;d[k]=m}else{var j=TdataAjaxProcessorManager.getPersonalizationAjaxProcessor(p,l,o,g);e.push(l);d.push(j)}}}}else{TdataLoggingInfo.setErrorMessage(2)}}else{TdataLoggingInfo.setErrorMessage(3)}})}}if(f){jQuery.each(d,function(g,h){if(AjaxServiceUtil.isNotBlank(h)){AjaxService.executeBeforeDomReadyProcessor(h)}})}else{TdataPromotionService.alreadyProcessedSlots={};jQuery.each(d,function(g,h){if(AjaxServiceUtil.isNotBlank(h)){AjaxService.registerAndExecuteAjaxProcessor(h);AjaxLogger.log("inventorySpaceId["+h.inventorySpaceId+"] removed from the Inventory Space ids list after success");TdataPromotionService.removeInvontorySpaceIdFromAllInventorySpaceList(h.inventorySpaceId);TdataPromotionService.removePromotionContainerIdByInventorySpaceId(h.inventorySpaceId)}});jQuery.each(a,function(g,h){AjaxLogger.log("inventorySpaceId["+h+"] removed from the Inventory Space ids list after success");TdataPromotionService.removeInvontorySpaceIdFromAllInventorySpaceList(h);TdataPromotionService.removePromotionContainerIdByInventorySpaceId(h)});TdataPromotionService.removeInvontorySpaceIdFromAllInventorySpaceListByContainerIds(e);TdataPromotionService.invokeAtgProcessorsForFailedInventorySpaces()}},tdataFailureCallback:function(b,c,a){TdataPromotionService.invokeAtgProcessorsForFailedInventorySpaces()},invokeAtgProcessorsForFailedInventorySpaces:function(){var b=this.listOfAllInventorySpaceIds;AjaxLogger.log("Start executing all fail back calls for tdata promotions, total number of calls["+b.length+"] ");var c=new Array();if(b.length!=0){AjaxLogger.log("isFailSafeEnabled ["+MyAttTdataConfig.isFailSafeEnabled+"]");jQuery.each(b,function(f,k){var h=false;if(MyAttTdataConfig.isFailSafeEnabled){var j=TdataPromotionService.getAtgProcessorIdByInventorySpaceId(k);AjaxLogger.log("inventorySpaceId ["+k+"] atgProcessorId["+j+"]");if(AjaxServiceUtil.isNotBlank(j)){if(DashboardPromotionManager.dashboardPage){var e=DashboardPromotionManager.postDashSyncComplete;AjaxLogger.log("DashboardPromotionManager.dashboardPage ["+DashboardPromotionManager.dashboardPage+"] isPostDashComplete["+e+"]");if(!e){AjaxLogger.log("Post Dash Sync is not completed so register to Atg Dashboard Promotion List");DashboardPromotionManager.registerAtgPromotionId(j);h=true}}if(!h){var g=CacheManager.get(j);AjaxLogger.log("FailSafe processor Id["+j+"] Object["+g+"]");if(AjaxServiceUtil.isNotBlank(g)){AjaxLogger.log("Request failed for inventorySpace["+k+"]");AjaxService.registerAndExecuteAjaxProcessor(g);h=true}}}}c.push(k)});AjaxLogger.log("failedCaseIds["+c+"]");if(c.length!=0){var d=TdataLoggingInfo.pageId;jQuery.each(c,function(e,g){TdataPromotionTracking.decreasePromotionCount();var f=CacheManager.get("tdata_promo_container_"+g);AjaxLogger.log("containerId for failed Inventory space id ["+f+"]");if(AjaxServiceUtil.isNotBlank(f)){AjaxLogger.log("Make inner html blank for containerId["+f+"] and InventorySpaceId["+g+"]");jQuery("#"+f).html("")}if(MyAttTdataConfig.logMetricsEnabled){if(d==""){d=g}else{d=d+","+g}}});if(MyAttTdataConfig.logMetricsEnabled){var a=TdataAjaxProcessorManager.getTdataFailureProcessor(d);AjaxService.registerAndExecuteAjaxProcessor(a)}}}this.listOfAllInventorySpaceIds=new Array()}};var RexServiceManager={handlePromotionOnClick:function(a){jQuery("#"+a).submit()},onClickWebTrendReporting:function(a){}};function openPromotionInNewWindow(a){window.open(a,"_blank");return false};