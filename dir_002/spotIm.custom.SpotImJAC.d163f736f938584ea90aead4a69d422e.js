var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))((function(i,a){function s(t){try{c(n.next(t))}catch(t){a(t)}}function r(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,r)}c((n=n.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var o,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function r(a){return function(r){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{o=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,r])}}},__spreadArray=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var n,i=0,a=e.length;i<a;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};!function(){var t="messages-count",e="navigate",o="scroll-lock",n="scroll-release",i="spotim_error",a="spotim_event",s="sso_api_ready",r="spot-im-renew-sso",c="sso_code_a",d="sso_login_error",l="sso_login_success",m="storage_update",p="spot-im-share-type",u="spot-im-conversation-failed",h="spot-im-conversation-loaded",f="ow-error-event",v="spot-im-launcher-failed",g="ow-performance-event",w="spot-im-show-more-replies-clicked",_="spot-im-show-more-comments-clicked",I="spot-im-sort-by-select",S="spot-im-user-down-vote-click",y="spot-im-user-up-vote-click",A="spot-im-clicked-settings",C="spot-im-login-start",E="spot-im-clicked-mute-user",O="spot-im-user-clicked-reply",b="spot-im-clicked-privacy",k="spot-im-clicked-flag",N="spot-im-current-user-sent-message-clicked",T="logout",R="startSafeframeSso",P="completeSSOCallback",L="modal",D="deeplink",M="qsp",J="conversation",x=function(){function x(t){var e,o,n;if(this.CONVERSATIONS_POSITION_NAME="OpenWebWidget",this.CONVERSATIONS_NODE_ID="spotIm-conversations-module-wrapper",this.LIGHTBOX_HEADER_CLASSNAME="wafer-lightbox-spotIm-header",this.LIGHTBOX_AD_NODE_ID="sda-WFPAD2",this.LIGHTBOX_AD_ID="WFPAD2",this.DARLA_AD_REFRESH_EVENT="refreshAdsOnCommentActions",this.DARLA_WFPAD2_REFRESH_EVENT="wfpad2Fetch",this.UPDATE_STORAGE_THROTTLE_MS=500,this.SPOT_IM_QUERY_PREFIXES=["openweb_","ow_","spot_im","spot_reset_password","spot_ticket","spotim_","tenant_config"],this.NAVIGATE_ALLOWED_LIST=["https://www.yahoo.com","https://api-2-0.spot.im","mailto:"],this.isDebug=!1,this.isStaging=!1,this.devJACVersion="",this.rightRailAdPosCount=6,this.modalJacPositionsMap={},t){this.spotImConfiguration=t,void 0===this.spotImConfiguration.conversationEnabled&&(this.spotImConfiguration.conversationEnabled=!0),this.pageContext=__assign(__assign({},null===(e=window.YAHOO)||void 0===e?void 0:e.context),null===(n=null===(o=window.vzm)||void 0===o?void 0:o.getPageContext)||void 0===n?void 0:n.call(o));try{this.isDebug="1"===localStorage.getItem("SPOTIM_JAC_DEBUG"),"1"===localStorage.getItem("SPOTIM_JAC_STAGE")&&(this.isStaging=!0);var i=localStorage.getItem("SPOTIM_JAC_VERSION")||"";i&&/^(\d+)\.(\d+)\.(\d+)$/.test(i)&&(this.devJACVersion=i)}catch(t){}this.updateStorageThrottled=window.wafer.utils.throttle(this.updateStorage,this.UPDATE_STORAGE_THROTTLE_MS,this);try{this.initialize()}catch(t){console.error(t),this.sendBeacon("spotIm-init-error",{message:t.message})}}else console.error("SpotImJAC: invalid configuration")}return x.prototype.getIsOpenWebParam=function(){var t=this;return window.location.search.slice(1).split("&").some((function(e){return t.SPOT_IM_QUERY_PREFIXES.some((function(t){return 0===e.split("=")[0].indexOf(t)}))}))},x.prototype.injectJAC=function(){var t=this,e=this.spotImConfiguration,o=e.enableFocusProtection,n=e.jacUrl;return new Promise((function(e,i){var a=function(){e(),window.JAC.on("AD_MESSAGE",(function(e){var o=e.meta;try{var n=o.message,i=void 0===n?"":n,a=o.positionName,s=JSON.parse(i),r=s.type,c=s.messages,d=void 0===c?[]:c;if("spotim"!==String(r).toLowerCase())return;d.forEach((function(e){return t.onMessageFromJAC(a,e)}))}catch(e){console.error(e),t.sendBeacon("spotIm-on-ad-message-fail")}}))};if(window.JAC_CONFIG={client:{focusProtection:!1,positions:{},onReady:a}},o&&(window.JAC_CONFIG.client.focusProtection=!0),window.JAC)a();else{var s=document.createElement("script");s.async=!0,s.src=n,t.devJACVersion&&(s.src="https://jac.yahoosandbox.com/".concat(t.devJACVersion,"/jac.js")),s.onerror=function(e){console.error(e),t.sendBeacon("spotIm-jac-inject-fail",{message:e}),i(e)},document.body.appendChild(s)}}))},x.prototype.initialize=function(){var t=this,e=this.spotImConfiguration,o=e.useCase,n=e.jacDomain,i=e.device,a=void 0===i?"":i,s=this.pageContext.device,r="smartphone"===(void 0===s?a:s);switch(window.JAC_BASE_URL=n,o){case D:this.injectJAC().then((function(){r?t.initForDeeplinkMobile():t.initForDeeplink()}));break;case L:this.initForModal(r);break;case M:this.initForQSP();break;default:throw new Error("Unknown useCase '".concat(o,"' given"))}},x.prototype.initForQSP=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.injectJAC()];case 1:return o.sent(),t=document.getElementById(this.CONVERSATIONS_NODE_ID),e=this.getJACPositionConfig({spotImConfig:this.spotImConfiguration,spotImType:J,targetElement:t,useCase:M}),window.JAC.createPosition(this.CONVERSATIONS_POSITION_NAME,{client:e,service:{}}),window.JAC.render([this.CONVERSATIONS_POSITION_NAME]),[2]}}))}))},x.prototype.initForDeeplink=function(){var t=this.spotImConfiguration,e=t.conversationEnabled,o=t.uuid;if(e){var n=document.getElementById(this.CONVERSATIONS_NODE_ID),i=document.querySelector(".caas-share-buttons .caas-comment");this.scrollToCommentsIfNeeded(n,i,o);var a=this.getJACPositionConfig({spotImConfig:this.spotImConfiguration,spotImType:J,targetElement:n,useCase:D});window.JAC.createPosition(this.CONVERSATIONS_POSITION_NAME,{client:a,service:{}}),window.JAC.render([this.CONVERSATIONS_POSITION_NAME])}},x.prototype.initForDeeplinkMobile=function(){this.spotImConfiguration.conversationEnabled&&(this.openMobileModalIfNeeded(),this.initForLightbox(this.spotImConfiguration))},x.prototype.initForModal=function(t){var e=this,o=this.spotImConfiguration,n=o.conversationEnabled,i=o.initLauncherOnClick,a=void 0!==i&&i,s=o.showSuspendedCommentsMessage,r=o.showViewCommentsCTA,c=this.injectJAC(),d=function(){for(var t=Object.keys(e.modalJacPositionsMap);t.length;){var o=t.pop();window.JAC.destroyPosition(o)}e.modalJacPositionsMap={}},l=function(o){var i=o.detail,a=i.elem,r=i.config,d=i.isMain;if(n&&c.then((function(){return e.initCommentsInModal(a,r,d,t)})),!t&&s){var l=document.getElementById("suspended-commenting-message-template");l&&(a.innerText=l.content.textContent,a.className=l.className)}};if(!t&&r&&!a){var m=B(),p=document.getElementById(this.CONVERSATIONS_NODE_ID),u=window.YAHOO.context.meta,h=u.title,f=u.url,v=u.uuid,g=__assign(__assign({},m),{title:encodeURIComponent(h),url:f,uuid:v});l({detail:{config:__assign({},g),elem:p,isMain:!0}})}window.addEventListener("initSpotImComments",l),window.addEventListener("viewerContentChanged",d),window.addEventListener("viewerClosed",d)},x.prototype.initForLightbox=function(t,e){var o=this;void 0===e&&(e=D);var n=function(){var t,n,i=B();if(i.showAdOnLightBox&&document.getElementById(o.LIGHTBOX_AD_NODE_ID)){var a=window.adsConfig,s=window.DARLA,r=s.config()&&s.config().positions;if((null===(t=null==a?void 0:a.clientPositionMeta)||void 0===t?void 0:t.positions.length)&&(!r||!r[o.LIGHTBOX_AD_ID])){var c=null===(n=null==a?void 0:a.clientPositionMeta)||void 0===n?void 0:n.positions.filter((function(t){return t.id===o.LIGHTBOX_AD_ID}));c.length&&s.addPos(c[0])}o.refreshAds()}var d=document.getElementById(o.CONVERSATIONS_NODE_ID);if(d){var l=o.getJACPositionConfig({spotImConfig:i,spotImType:J,targetElement:d,useCase:e});window.JAC.createPosition(o.CONVERSATIONS_POSITION_NAME,{client:l,service:{}}),window.JAC.render([o.CONVERSATIONS_POSITION_NAME])}},i=function(){document.getElementById(o.CONVERSATIONS_NODE_ID)&&window.JAC.destroyPosition(o.CONVERSATIONS_POSITION_NAME)},a=window.wafer;a.removeListener&&(a.removeListener("lightbox:open",n),a.removeListener("lightbox:close",i)),a.on("lightbox:open",n),a.on("lightbox:close",i);var s=document.getElementById("view-comments-wrapper"),r=document.getElementById("spot-im-wafer-lightbox");s&&r&&s.addEventListener("click",(function(){r.click()}))},x.prototype.initCommentsInModal=function(t,e,o,n){var i=o?this.CONVERSATIONS_POSITION_NAME:"".concat(this.CONVERSATIONS_POSITION_NAME,"-").concat(e.uuid);if(n)this.initForLightbox(e,L),this.openMobileModalIfNeeded();else{var a=e.showRightRailAds,s=void 0!==a&&a,r=e.uuid,c=document.querySelector("[data-comments-id=".concat(t.id,"] .caas-share-buttons .caas-comment"));this.scrollToCommentsIfNeeded(t,c,r);var d=t;s&&(this.addSpotImRightRailMarkup(t,e),d=document.getElementById("".concat(t.id)));var l=this.getJACPositionConfig({spotImConfig:e,spotImType:J,targetElement:d,useCase:L});window.JAC.createPosition(i,{client:l,service:{}}),window.JAC.render([i])}this.modalJacPositionsMap[i]=e},x.prototype.getConversationStyles=function(t){var e=t.useCase,o=t.isMobile,n=t.shareSectionWidth,i=t.contentWidth;if(t.isHorizontalLayoutPage)return"#spotIm-in-jac-conversations.deeplink-desktop, #spotIm-in-jac-conversations.deeplink-desktop.news-en-US {\n                        position: relative;\n                        margin: auto;\n                        width: 830px;\n                        left: unset;\n                }";switch(e){case D:return o?"#spotIm-in-jac-conversations.deeplink-smartphone {\n                            width: calc(100% - 20px);\n                            margin: 0 auto;\n                        }":"#spotIm-in-jac-conversations.deeplink-desktop {\n                        width: calc(85% - 300px);\n                        margin-left: ".concat(n,"px;\n                    }\n                    #spotIm-in-jac-conversations.deeplink-desktop.adsStreamLayout {\n                        width: 75%;\n                    }\n                    #spotIm-in-jac-conversations.deeplink-desktop.news-en-US {\n                        width: 85%;\n                        position: relative;\n                        left: 9%;\n                        margin-left: ").concat(n,"px;\n                    }");case L:return"#spotIm-in-jac-conversations.modal-desktop {\n                        width: ".concat(i,"px;\n                        margin-left: ").concat(n,"px;\n                        padding-right: 10%;\n                    }");case M:return"#spotIm-in-jac-conversations.qsp-desktop {\n                        width: 100%;\n                        margin-left: ".concat(n,"px;\n                    }\n                    #spotIm-in-jac-conversations .spot-im-conversation-module {\n                        margin: 0;\n                    }");default:return""}},x.prototype.getJACPositionConfig=function(t){var e,o,n=this,i=t.spotImConfig,a=t.targetElement,s=t.spotImType,r=t.useCase;if(["spotImConfig","targetElement","spotImType","useCase"].forEach((function(e){if(!t[e])throw new Error("getJACPositionConfig: param '".concat(e,"' is missed"))})),!a.id)throw new Error("getJACPositionConfig: targetElement doesn't have required DOM id attribute");var c=i.device,d=void 0===c?"":c,l=i.launcherUrl,m=i.leftRailWidth,p=void 0===m?"":m,u=i.messages_cnt,h=i.passiveReactionEnabled,f=i.showRightRailAds,v=void 0!==f&&f,g=i.showViewCommentsCTA,w=void 0!==g&&g,_=i.stageSpotId,I=i.url,S=i.uuid,y=i.spotId;this.isStaging&&_&&(y=_);var A=l+y,C=this.pageContext,E=C.device,O=void 0===E?d:E,b=C.contentSite,k=void 0===b?"":b,N=C.site,T=void 0===N?"":N,R=C.lang,P=void 0===R?"":R,L=C.meta,D=void 0===L?{}:L,x=D.contentType,B=void 0===x?"story":x,F=D.siteAttribute,j=void 0===F?"":F,V="smartphone"===O,W=s===J,H=V&&document.getElementsByClassName(this.LIGHTBOX_HEADER_CLASSNAME)&&document.getElementsByClassName(this.LIGHTBOX_HEADER_CLASSNAME)[0],q=H&&H.offsetHeight||57,U=a.offsetWidth;if(w&&!U){var G=document.getElementById("view-cmts-container-".concat(S));U=v?G.offsetWidth-320:G.offsetWidth}var X=V&&W?window.innerWidth:U,Y=V?window.innerHeight-q-70:330,z=p||(null===(e=document.querySelector("#Masterwrap .caas-share-section, #content-articles-wrapper .caas-share-section"))||void 0===e?void 0:e.clientWidth)||0,Q=(null===(o=document.querySelector(".caas-content-wrapper"))||void 0===o?void 0:o.clientWidth)||0,$=document.getElementsByClassName("adsStreamWrapper")[0],K=document.querySelector("#Masterwrap2Col.horizontalLayout"),Z=this.getConversationStyles({useCase:r,isMobile:V,isHorizontalLayoutPage:K,shareSectionWidth:z,contentWidth:Q}),tt=new URL(I);if("qsp"!==r){tt.searchParams.append("ref","spot-im-jac")}var et=tt.toString(),ot=__spreadArray([],/rs="lmsid:([\w]+);?/gi.exec(j)||[],!0)[1],nt=void 0===ot?"yahoo":ot,it="";try{it=localStorage.getItem("OW_STORAGE")||""}catch(t){a.style.display="none",console.error("SpotIm(JAC) OW_STORAGE LS read error: ",t),this.sendBeacon("spotIm-ow-storage-LS-read-error")}var at=window.location.search.slice(1).split("&").filter((function(t){return n.SPOT_IM_QUERY_PREFIXES.some((function(e){var o=t.split("="),n=o[0],i=o[1];return"ref"===n&&0===(void 0===i?"":i).indexOf("spot-im")||0===n.indexOf(e)}))})).join("&"),st=window.location.href.split("?")[0]+(at?"?".concat(at):""),rt=k||T;"finance"!==T&&"sports"!==T||(rt=T);var ct=h?"data-labels-section=".concat("finance"===rt&&r===M?"stock":rt):"",dt="modal"!==r?"data-custom-product-type=non-modal":"data-custom-product-type=modal";if(s!==J)throw new Error("Unexpected spotImType: ".concat(s));return{safeFrame:{enabled:!0,features:{resize:{enabled:!0}}},meta:{OpenWeb:{hostUrl:st,localStorage:it}},content:{markup:"\n                        ".concat("qsp"===r?'<meta name="filter-finmb"/>':"","\n                        <style>\n                            #fc_align {\n                                width: 100%;\n                                ").concat(V?"overflow-y: auto; height: 100%;":"","\n                            }\n                            ").concat(Z,'\n                        </style>\n                        <div id="spotIm-in-jac-conversations" class="').concat(r,"-").concat(O," ").concat(rt,"-").concat(P).concat($?" adsStreamLayout":"",'">\n                            <script\n                                async\n                                type="text/javascript"\n                                src="').concat(A,'"\n                                data-safeframe-height="').concat(Y,'"\n                                data-safeframe-width="').concat(X,'"\n                                data-spotim-module="spotim-launcher"\n                                data-spot-id="').concat(y,'"\n                                data-post-id="').concat(S,'"\n                                data-post-url="').concat(et,'"\n                                data-article-tags="').concat(rt,'"\n                                data-custom-page-structure="additive"\n                                data-is-full-screen="').concat(V,'"\n                                data-messages-count="').concat(u,'"\n                                data-custom-partner-id="').concat(nt,'"\n                                data-custom-page-type="').concat(B,'"\n                                data-custom-product-id="yahoo_').concat(rt,'"\n                                ').concat(ct,"\n                                ").concat(dt,"\n                                ").concat("qsp"===r?"data-post-staleness-days=0":"","\n                            >\n                            <\/script>\n                        </div>"),size:{width:X,height:Y}},targetElement:a.id}},x.prototype.onMessageFromJAC=function(p,u){var h=u.action,f=u.args;this.debugLog("onMessageFromJAC",{action:h,args:f,positionName:p});var v=this.modalJacPositionsMap[p]||this.spotImConfiguration;switch(h){case s:case r:this.onSSOReady(p);break;case c:this.startSSOFlow(f.code_a,v,p);break;case d:this.sendBeacon("spotIm-sso-fail");break;case l:this.sendBeacon("spotIm-sso-success")}switch(h){case a:var g=f.params,w=f.type;this.onSpotImEvent(w,g,v,p);break;case m:var _=f.storage;this.updateStorageThrottled(_);break;case e:var I=f.url;this.openLinkFromSpotIm(I);break;case i:var S=f.type,y=f.error;this.sendBeacon("spotIm-inner-error",{type:S,error:y});break;case o:window.document.body.classList.add("ow-modal-opened");break;case n:window.document.body.classList.remove("ow-modal-opened");break;case t:var A=Number(f),C=v.uuid;if(!isNaN(A)){var E=document.querySelector('.reactions-count[data-id="'.concat(C,'"]'));E&&(E.innerHTML="".concat(A),E.setAttribute("style","display:block"))}}},x.prototype.onSpotImEvent=function(t,e,o,n){var i=this;this.debugLog("onSpotImEvent",{eventName:t,params:e});var a=function(t){i.sendRapid(t,o)},s=o.showViewCommentsCTA,r=o.initLauncherOnClick,c=void 0!==r&&r,d=o.showRightRailAds,l=void 0!==d&&d,m=o.uuid,T=e||{},R=T.message_id,P=void 0===R?"":R,L=T.parent_id,D=void 0===L?"":L,M=T.message_type,J=void 0===M?"":M;switch(t){case C:this.goToAuth();break;case E:a({slk:"mute",elm:"cmmt_mute",outcm:"close"});break;case p:var x=e.type;a({slk:void 0===x?"":x,elm:J?"cmmt_share_"+J:"cmmt_share",msg_id:P,outcm:"open",parent_id:D});break;case I:var B=e.sortedBy;a({slk:void 0===B?"":B,elm:"cmmt_sort_btn",outcm:"sort"});break;case N:this.refreshAds(),a({slk:J,elm:"cmmt_post",msg_id:D,outcm:"post"});break;case O:this.refreshAds(),a({slk:"reply",elm:"cmmt_reply"});break;case w:this.refreshAds(),a({slk:"open reply",elm:"cmmt_more",elmt:"showreply",outcm:"show",parent_id:D,msg_id:P,sec:"cmmts"});break;case k:a({slk:"abuse",elm:"cmmt_abuse",outcm:"open",msg_id:P,parent_id:D});break;case b:a({slk:"privacy",elm:"cmmt_username",sec:"cmmt_his"});break;case A:a({slk:"your settings",elm:"cmmt_username",sec:"cmmt_his"});break;case y:a({slk:"vote thumb_up",elm:"cmmt_vote",parent_id:D,msg_id:P,outcm:"rate"});break;case S:a({slk:"vote thumb_down",elm:"cmmt_vote",parent_id:D,msg_id:P,outcm:"rate"});break;case _:this.refreshAds(),l&&this.loadStickyRightRailAds(o),this.updateUser(o),a({slk:"load more",elm:"cmmt_more",outcm:"more"});break;case u:case v:this.sendBeacon("spotIm-inner-fail:".concat(t));break;case h:if(l&&this.initRightRailAds(m),s&&!c)return;window.rapidInstance.beaconEvent("openweb_module_view",{sec:"cmmts",subsec:"openweb",etrg:"show",outcm:"openweb_module_view"});break;case g:this.reportPerformance(e);break;case f:this.reportError(e)}},x.prototype.refreshAds=function(){var t=window.DARLA,e=null==t?void 0:t.evtSettings(this.DARLA_AD_REFRESH_EVENT),o=null==t?void 0:t.evtSettings(this.DARLA_WFPAD2_REFRESH_EVENT);e&&e.ps&&t.event(this.DARLA_AD_REFRESH_EVENT),o&&o.ps&&t.event(this.DARLA_WFPAD2_REFRESH_EVENT)},x.prototype.goToAuth=function(){var t=this.pageContext,e=t.lang,o=void 0===e?"en-US":e,n=t.site,i="fp"===n?"homepage":n,a=window.YAHOO.i13n&&window.YAHOO.i13n.SPACEID||2023538075,s=window.location.href+(window.location.search?"&":"?")+"a20_comeback_from_auth=1",r="https://login.yahoo.com/?.lang=".concat(o,"&src=").concat(i,"&pspid=").concat(a,"&activity=comments&.done=").concat(encodeURIComponent(s));window.location.href=r},x.prototype.onSSOReady=function(t){var e=this.pageContext,o=e.authed,n=void 0===o?"0":o,i=e.guid;"1"===n?this.sendMessageToJAC({action:R,args:{userId:i}},t):this.sendMessageToJAC({action:T},t)},x.prototype.sendMessageToJAC=function(t,e){var o=Math.random().toString(36).substring(2,15)+Date.now();this.debugLog("sendMessageToJAC",t),window.JAC.updateMeta([e||this.CONVERSATIONS_POSITION_NAME],"openWeb",JSON.stringify(__assign({type:"SPOTIM",id:o},t)))},x.prototype.startSSOFlow=function(t,e,o){var n=this;this.debugLog("startSSOFlow",{codeA:t});var i=e.xhrPathPrefix,a=e.useStageToken,s=void 0!==a&&a,r=e.useCase,c=e.spotId,d=e.stageSpotId,l="".concat(i,"?m_id=spotIm&ctrl=SpotImSSO&m_mode=json");fetch(l,{body:JSON.stringify({m_id:"spotIm",ctrl:"SpotImSSO",m_mode:"json",code_a:t,useStageToken:Boolean(s||this.isStaging),useCase:r,spotId:this.isStaging?d:c}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(t){if(200!==t.status)throw new Error("Request error");return t.json()})).then((function(t){var e=t.html;if(!e)throw new Error("SpotIm: codeB getting error");n.sendMessageToJAC({action:P,args:e},o)})).catch((function(t){n.sendBeacon("spotIm-sso-fail")}))},x.prototype.updateStorage=function(t){try{localStorage.setItem("OW_STORAGE",JSON.stringify(t))}catch(t){this.sendBeacon("spotIm-storage-update-fail")}},x.prototype.openLinkFromSpotIm=function(t){void 0===t&&(t=""),this.NAVIGATE_ALLOWED_LIST.some((function(e){return 0===t.indexOf(e)}))&&(window.location.href=t)},x.prototype.sendBeacon=function(t,e){var o,n,i,a,s;void 0===e&&(e={});var r=this.pageContext,c=["browserName","device","lang","region","rid","site"].reduce((function(t,e){return"".concat(t,"&").concat(e,"=").concat(r[e]||"")}),""),d=Object.keys(e).reduce((function(t,o){return"".concat(t,"&").concat(o,"=").concat(e[o])}),""),l=(null===(n=null===(o=window.YAHOO)||void 0===o?void 0:o.errBeaconConfig)||void 0===n?void 0:n.beaconPath)||"_td_api/beacon/error";null===(s=null===(a=null===(i=window.wafer)||void 0===i?void 0:i.utils)||void 0===a?void 0:a.fireBeacon)||void 0===s||s.call(a,"/".concat(l,"?beaconName=").concat(t).concat(d).concat(c))},x.prototype.sendRapid=function(t,e){var o=t.elm,n=void 0===o?"":o,i=t.elmt,a=void 0===i?"":i,s=t.eventType,r=void 0===s?"click":s,c=t.itc,d=void 0===c?1:c,l=t.msg_id,m=void 0===l?"":l,p=t.parent_id,u=void 0===p?"":p,h=t.noContent,f=void 0!==h&&h,v=t.outcm,g=void 0===v?"":v,w=t.pos,_=void 0===w?0:w,I=t.sec,S=void 0===I?"cmmts":I,y=t.slk,A=void 0===y?"":y,C=t.subsec,E=void 0===C?"openweb":C,O=t.tar,b=void 0===O?"":O,k=t.tar_uri,N=void 0===k?"":k,T=e.uuid;if(window.rapidInstance){var R={elm:n,elmt:a,g:"",itc:d,outcm:g,subsec:E,tar:b,tar_uri:N,msg_id:m,parent_id:u};R.g=f?"":T,"view"===r?window.rapidInstance.beaconLinkViews([{sec:S,_links:[{slk:A,elm:n,itc:d}]}]):"click"===r&&window.rapidInstance.beaconClick(S,A,_,R)}},x.prototype.scrollToCommentsIfNeeded=function(t,e,o){var n=t||document.getElementById(this.CONVERSATIONS_NODE_ID);if(n){var i=this.getIsOpenWebParam(),a=function(){var t=document.querySelector("#view-cmts-container-".concat(o)),e=document.querySelector("#view-cmts-cta-".concat(o));t&&t.classList.add("showComments"),e&&e.classList.add("hide");var i=t||n,a=function(){return i.scrollIntoView({behavior:"smooth",block:"center"})};a(),setTimeout(a,1e3)};i&&a(),e&&e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),a()}))}},x.prototype.openMobileModalIfNeeded=function(){var t=document.getElementById("spot-im-wafer-lightbox");if(t){var e=this.getIsOpenWebParam(),o=/(\?|&)a20_comeback_from_auth=1/gi.test(window.location.search);(e||o)&&t.click()}},x.prototype.updateUser=function(t){var e=this,o=this.pageContext.authed;if("1"===(void 0===o?"0":o)){this.debugLog("updateUser",t);var n=t.xhrPathPrefix,i=t.useStageToken,a=void 0!==i&&i,s=t.useCase,r=t.spotId,c=t.stageSpotId,d="".concat(n,"?m_id=spotIm&ctrl=SpotImSSO&m_mode=json");fetch(d,{body:JSON.stringify({action:"update",m_id:"spotIm",ctrl:"SpotImSSO",m_mode:"json",useStageToken:Boolean(a||this.isStaging),useCase:s,spotId:this.isStaging?c:r}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(t){if(200!==t.status)throw new Error("Request error")})).catch((function(t){e.debugLog("SpotIm updateUser fetch error",{error:t}),e.sendBeacon("spotIm-update-user-failure")}))}},x.prototype.debugLog=function(t,e){this.isDebug&&console.warn("[SpotIm-JAC-Debug]: ",t,e)},x.prototype.reportPerformance=function(t){var e=t.source,o=t.time,n=t.type;this.sendBeacon("spotIm-perf",{source:e,time:o,type:n})},x.prototype.reportError=function(t){var e=t.source,o=t.type;this.sendBeacon("spotIm-ow-error",{source:e,type:o})},x.prototype.addSpotImRightRailMarkup=function(t,e){var o=t.parentElement,n=t.cloneNode(!0),i=document.createElement("div");i.className="spotim-rr W(100%) D(f)";var a=document.createElement("main");a.className="spotim-main-section W($mainColWidth) Mend(20px)",a.appendChild(n);var s=document.createElement("aside");s.className="spotim-aside-section W(300px) D(f) Fld(c)";var r=this.getDarlaMarkup(e),c=document.createElement("div");c.className="spotim-non-sticky-sda",c.appendChild(r),s.appendChild(c);var d=document.createElement("div");d.className="spotim-sticky-sda-container Fxg(1) wafer wafer-sticky",d.setAttribute("data-wf-sticky-boundary","spotim-aside-section"),d.setAttribute("data-wf-sticky-offset","165px   10px"),d.setAttribute("data-wf-sticky-target",".spotim-sticky-sda");var l=document.createElement("div");l.className="spotim-sticky-sda",d.appendChild(l),s.appendChild(d),i.appendChild(a),i.appendChild(s),o.replaceChild(i,t)},x.prototype.getDarlaMarkup=function(t){var e=t.adPositions,o=void 0===e?"":e,n=t.rightRailAdClasses,i=void 0===n?"":n,a=t.wfDarlaConfig,s=void 0===a?{}:a,r=this.rightRailAdPosCount,c=s.offsetX,d=s.offsetY,l=Object.assign({},s),m=o.split(",");l.meta={},l.pos=m.reduce((function(t,e){var o="".concat(e,"-").concat(r);return s.meta[e]&&(l.meta[o]=s.meta[e]),t?"".concat(t,",").concat(o):o}),"");var p=document.createElement("div");return p.className="".concat(i),p.setAttribute("data-wf-margin","".concat(d," ").concat(c)),p.setAttribute("data-wf-trigger","viewport"),p.setAttribute("data-wf-darla-config","".concat(JSON.stringify(l))),m.forEach((function(t){var e=document.createElement("div");e.setAttribute("id","wafer-darla-clean-".concat(t,"-").concat(r));var o=document.createElement("div");o.setAttribute("id","wafer-darla-".concat(t,"-").concat(r)),e.appendChild(o),p.appendChild(e)})),this.rightRailAdPosCount++,p},x.prototype.initRightRailAds=function(t){var e=document.querySelector("#view-cmts-container-".concat(t," .spotim-non-sticky-sda"));if(e&&!e.classList.contains("da-spotim-active")){var o=document.querySelector('[data-post-id="'.concat(t,'"] .spcv_conversation-header')),n=null==o?void 0:o.offsetParent,i=document.querySelector('[data-post-id="'.concat(t,'"] .spcv_main-say-control-wrapper')),a=(null==o?void 0:o.offsetHeight)+(null==n?void 0:n.offsetTop)+(null==i?void 0:i.offsetTop)||240;e.style.marginTop="".concat(a,"px"),e.classList.add("da-spotim-active")}var s=document.querySelector("#view-cmts-container-".concat(t," .spotim-non-sticky-sda .da-spotim"));s.classList.add("wafer","wafer-darla"),s&&window.wafer.base.sync(e)},x.prototype.loadStickyRightRailAds=function(t){var e=t.uuid,o=document.querySelector("#view-cmts-container-".concat(e," .spotim-sticky-sda"));if(o&&!o.classList.contains("da-spotim-active")){var n=document.querySelector("#view-cmts-container-".concat(e," .spotim-non-sticky-sda.da-spotim-active"));if(n){n.style.marginBottom="500px";var i=this.getDarlaMarkup(t);i.classList.add("wafer","wafer-darla"),o.appendChild(i),i&&window.wafer.base.sync(o),o.classList.add("da-spotim-active")}}},x}();function B(){var t=document.getElementById("spotim-config");return t&&window.wafer.utils.getConfigFromJSONScriptNode(t).config||window.wafer.base.state.spotIm}function F(t){new x(t)}"undefined"!=typeof process&&(window.__SpotImJAC=x),window.wafer&&window.wafer.ready((function(){var t=B();t?F(t):window.wafer.on("module:added",(function(t){if("spotIm-conversations"===t.meta.id){var e=B();(null==e?void 0:e.useCase)===M&&F(e)}}))}),window)}();